#!/bin/bash

now=`date +%Y-%m-%d_%H-%M-%S`
backup_directory="//data/backups"
current_backup=$backup_directory/$now"_in"
last_backup=`tail $backup_directory/last_backup -n1`

logfile="/var/log/db-backup/"$now"_in"

mysql_user="sbiadmin"
mysql_pass="t1m3t0J@M"

echo "========================================="
echo "      MySQL Data Backup (Incremental)"
echo "========================================="

#perform incremental backup from where the last backup stoped
innobackupex --ibbackup=xtrabackup_55 --parallel=4 --user=$mysql_user --password=$mysql_pass --no-timestamp --incremental --incremental-basedir=$last_backup $current_backup 2> $logfile

# see if the backup completed sucsessfully
if ! tail $logfile -n 1 | grep completed.OK
then
        rm -R $current_backup
        echo "\nERROR: backup failed! (log: "$logfile")"
  exit 1
fi

echo $current_backup >> $backup_directory/last_backup

echo "Backup Completed OK!"


